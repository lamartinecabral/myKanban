rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{colId}/{docId} {

      allow get: if 
        colId in ['boards','columns','cards','comments'] &&
        request.auth != null &&
        resource.data.uid == request.auth.uid
      
      allow list: if 
        colId in ['boards','columns','cards','comments'] &&
        request.auth != null && (
          colId == 'boards' && request.auth.uid == resource.data.uid ||
          colId == 'columns' && request.auth.uid == get(/databases/$(database)/documents/boards/$(resource.data.board_id)).data.uid ||
          colId == 'cards' && request.auth.uid == get(/databases/$(database)/documents/columns/$(resource.data.column_id)).data.uid ||
          colId == 'comments' && request.auth.uid == get(/databases/$(database)/documents/cards/$(resource.data.card_id)).data.uid
        )
      
      allow create: if 
        colId in ['boards','columns','cards','comments'] &&
        request.auth != null &&
        request.resource.data.uid == request.auth.uid
      
      allow update: if 
        colId in ['boards','columns','cards','comments'] &&
        request.auth != null &&
        request.resource.data.uid == resource.data.uid

      allow delete: if 
        colId in ['boards','columns','cards','comments'] &&
        request.auth != null &&
        resource.data.uid == request.auth.uid
      
    }
  }
}